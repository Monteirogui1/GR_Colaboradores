{% extends "layouts/base.html" %}
{% block title %}{{ contrato.nome }} - Regras SLA{% endblock %}
{% block conteudo %}
<div class="content">
    <div class="page-header">
        <h1><i class="bi bi-clock-history"></i> {{ contrato.nome }}</h1>
        <div>
            <a href="{% url 'tickets:regra_sla_create' contrato.pk %}" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Nova Regra
            </a>
            <a href="{% url 'tickets:contrato_sla_update' contrato.pk %}" class="btn btn-secondary">
                <i class="bi bi-pencil"></i> Editar Contrato
            </a>
            <a href="{% url 'tickets:contrato_sla_list' %}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Voltar
            </a>
        </div>
    </div>

    <!-- Info do Contrato -->
    <div class="detail-card">
        <h2>Informações do Contrato</h2>
        <div class="detail-content">
            <div class="detail-info">
                <div class="detail-row">
                    <span class="detail-label">Nome:</span>
                    <span class="detail-value">{{ contrato.nome }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Descrição:</span>
                    <span class="detail-value">{{ contrato.descricao|default:"-" }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Contrato Padrão:</span>
                    <span class="detail-value">
                        {% if contrato.is_padrao %}
                            <span class="badge" style="background-color: #007bff; color: white;">Sim</span>
                        {% else %}
                            Não
                        {% endif %}
                    </span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Status:</span>
                    <span class="detail-value">
                        <span class="badge" style="background-color: {% if contrato.ativo %}#28a745{% else %}#6c757d{% endif %}; color: white;">
                            {% if contrato.ativo %}Ativo{% else %}Inativo{% endif %}
                        </span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Regras -->
    <div class="detail-card">
        <h2>Regras do Contrato ({{ regras|length }})</h2>
        <div class="detail-content" style="padding: 0;">
            {% if regras %}
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Ordem</th>
                                <th>Nome</th>
                                <th>Prazo Solução (h)</th>
                                <th>Primeira Resposta (h)</th>
                                <th>Tipo Horário</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for regra in regras %}
                            <tr>
                                <td><strong>{{ regra.ordem }}</strong></td>
                                <td>{{ regra.nome }}</td>
                                <td>{{ regra.prazo_solucao }}h</td>
                                <td>{{ regra.prazo_primeira_resposta|default:"-" }}</td>
                                <td>{{ regra.get_tipo_horario_display }}</td>
                                <td>
                                    <span class="badge" style="background-color: {% if regra.ativo %}#28a745{% else %}#6c757d{% endif %}; color: white;">
                                        {% if regra.ativo %}Ativa{% else %}Inativa{% endif %}
                                    </span>
                                </td>
                                <td>
                                    <a href="{% url 'tickets:regra_sla_update' regra.pk %}" class="btn btn-sm btn-edit" title="Editar">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <form method="post" action="{% url 'tickets:regra_sla_delete' regra.pk %}" style="display: inline;" onsubmit="return confirm('Tem certeza que deseja excluir esta regra?');">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-sm btn-delete" title="Excluir">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div style="text-align: center; padding: 60px 20px; color: #999;">
                    <i class="bi bi-clock-history" style="font-size: 64px; display: block; margin-bottom: 20px;"></i>
                    <p style="font-size: 18px; margin-bottom: 20px;">Nenhuma regra cadastrada</p>
                    <a href="{% url 'tickets:regra_sla_create' contrato.pk %}" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> Criar Primeira Regra
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}