{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Suporte{% endblock %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body { background: #f5f7fa; font-family: 'Segoe UI', sans-serif; color: #333; }

        /* ── TOPBAR ── */
        .portal-topbar {
            position: sticky; top: 0; z-index: 200;
            height: 56px;
            background: #fff;
            border-bottom: 1px solid #e8eaed;
            box-shadow: 0 1px 4px rgba(0,0,0,.06);
            display: flex; align-items: center;
            padding: 0 28px; gap: 0;
        }

        .topbar-brand {
            display: flex; align-items: center; gap: 9px;
            font-size: 17px; font-weight: 700;
            color: #1a73e8; text-decoration: none;
            margin-right: 30px; white-space: nowrap;
        }
        .topbar-brand i { font-size: 22px; }
        .topbar-brand span { color: #444; font-weight: 600; }

        /* ── NAV LINKS ── */
        .portal-nav { display: flex; align-items: center; gap: 2px; flex: 1; }

        .portal-nav a {
            display: flex; align-items: center; gap: 6px;
            padding: 6px 13px; border-radius: 6px;
            font-size: 14px; color: #555;
            text-decoration: none;
            transition: background .15s, color .15s;
            white-space: nowrap;
        }
        .portal-nav a i { font-size: 15px; }
        .portal-nav a:hover { background: #f0f4ff; color: #1a73e8; }
        .portal-nav a.active { background: #e8f0fe; color: #1a73e8; font-weight: 600; }

        .nav-sep { width: 1px; height: 22px; background: #e8eaed; margin: 0 8px; }

        /* ── USER AREA ── */
        .topbar-user {
            display: flex; align-items: center; gap: 10px;
            margin-left: auto; padding-left: 20px;
        }
        .topbar-user .username {
            font-size: 13px; color: #666;
            display: flex; align-items: center; gap: 6px;
        }
        .topbar-user form button {
            display: flex; align-items: center; gap: 5px;
            background: none; border: 1px solid #e0e0e0;
            border-radius: 6px; padding: 5px 12px;
            font-size: 13px; color: #666; cursor: pointer;
            transition: all .15s;
        }
        .topbar-user form button:hover {
            background: #fef2f2; border-color: #fca5a5; color: #dc2626;
        }

        /* ── CONTENT ── */
        .portal-main {
            max-width: 1320px; margin: 0 auto;
            padding: 28px 28px 48px;
        }

        /* ── PAGE HEADER ── */
        .page-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 22px; flex-wrap: wrap; gap: 10px;
        }
        .page-header h1 {
            font-size: 22px; font-weight: 700; color: #1f2937;
            display: flex; align-items: center; gap: 8px;
        }
        .page-header h1 i { color: #1a73e8; font-size: 20px; }

        /* ── CARDS ── */
        .detail-card {
            background: #fff; border-radius: 10px;
            border: 1px solid #e8eaed;
            box-shadow: 0 1px 4px rgba(0,0,0,.05);
            margin-bottom: 20px; overflow: hidden;
        }
        .detail-card h2 {
            font-size: 14px; font-weight: 600; color: #374151;
            padding: 14px 20px; margin: 0;
            border-bottom: 1px solid #f3f4f6;
            display: flex; align-items: center; gap: 7px;
            background: #fafafa;
            text-transform: uppercase; letter-spacing: .4px;
        }
        .detail-card h2 i { color: #1a73e8; font-size: 15px; }
        .detail-content { padding: 20px; }

        /* ── FORM GRID ── */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 18px; padding: 20px;
        }
        .form-grid + .form-grid { padding-top: 0; }

        .form-group { display: flex; flex-direction: column; gap: 5px; }
        .form-group.full-width { grid-column: 1 / -1; }

        .form-group label {
            font-size: 13px; font-weight: 600; color: #374151;
        }
        .form-group label.required::after {
            content: ' *'; color: #ef4444; font-size: 12px;
        }

        .form-control, .form-group input, .form-group select, .form-group textarea {
            border: 1px solid #d1d5db; border-radius: 7px;
            padding: 9px 12px; font-size: 14px; color: #374151;
            background: #fff; transition: border .2s, box-shadow .2s;
            width: 100%;
        }
        .form-control:focus, .form-group input:focus,
        .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 3px rgba(26,115,232,.12);
        }
        .form-group textarea { min-height: 110px; resize: vertical; }

        .form-hint { font-size: 12px; color: #9ca3af; margin-top: 3px; }
        .text-danger { font-size: 12px; color: #ef4444; margin-top: 3px; }

        /* checkbox estilizado */
        .check-group {
            display: flex; align-items: center; gap: 8px;
            padding: 10px 12px; border: 1px solid #d1d5db;
            border-radius: 7px; background: #fafafa; cursor: pointer;
        }
        .check-group input[type=checkbox] { width: 16px; height: 16px; cursor: pointer; accent-color: #1a73e8; }
        .check-group span { font-size: 14px; color: #374151; }

        /* color input */
        input[type=color] {
            padding: 3px 6px; height: 40px; width: 70px; cursor: pointer;
            border: 1px solid #d1d5db; border-radius: 7px;
        }

        /* ── FORM ACTIONS ── */
        .form-actions {
            display: flex; justify-content: flex-end; align-items: center;
            gap: 10px; padding: 16px 20px;
            border-top: 1px solid #f3f4f6;
            background: #fafafa;
        }

        /* ── BUTTONS ── */
        .btn {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 9px 18px; border-radius: 7px; font-size: 14px;
            font-weight: 500; cursor: pointer; border: none;
            text-decoration: none; transition: all .15s;
        }
        .btn-primary { background: #1a73e8; color: #fff; }
        .btn-primary:hover { background: #1557b0; }
        .btn-secondary { background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }
        .btn-secondary:hover { background: #e5e7eb; }
        .btn-danger { background: #fee2e2; color: #dc2626; }
        .btn-danger:hover { background: #fecaca; }
        .btn-success { background: #dcfce7; color: #16a34a; }
        .btn-success:hover { background: #bbf7d0; }
        .btn-sm { padding: 5px 11px; font-size: 13px; }

        /* ── TABLE ── */
        .table-wrapper {
            overflow-x: auto; border-radius: 10px;
            border: 1px solid #e8eaed;
        }
        .table {
            width: 100%; border-collapse: collapse; font-size: 14px;
        }
        .table thead th {
            padding: 11px 16px; background: #f8f9fb;
            font-weight: 600; color: #6b7280; font-size: 12px;
            text-transform: uppercase; letter-spacing: .4px;
            border-bottom: 1px solid #e8eaed; white-space: nowrap;
        }
        .table tbody td {
            padding: 13px 16px; border-bottom: 1px solid #f3f4f6;
            color: #374151; vertical-align: middle;
        }
        .table tbody tr:last-child td { border-bottom: none; }
        .table tbody tr:hover { background: #fafbff; }

        /* ── BADGE ── */
        .badge {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 3px 10px; border-radius: 20px;
            font-size: 12px; font-weight: 600;
        }
        .badge-success { background: #dcfce7; color: #16a34a; }
        .badge-danger { background: #fee2e2; color: #dc2626; }
        .badge-warning { background: #fef9c3; color: #ca8a04; }
        .badge-info { background: #dbeafe; color: #1d4ed8; }
        .badge-secondary { background: #f3f4f6; color: #6b7280; }

        /* ── EMPTY STATE ── */
        .empty-state {
            text-align: center; padding: 60px 20px; color: #9ca3af;
        }
        .empty-state i { font-size: 56px; display: block; margin-bottom: 14px; color: #d1d5db; }
        .empty-state p { font-size: 15px; margin-bottom: 18px; }

        /* ── FILTER BAR ── */
        .filter-form {
            display: flex; flex-wrap: wrap;
            align-items: flex-end; gap: 14px;
            padding: 16px 20px;
            background: #fff; border: 1px solid #e8eaed;
            border-radius: 10px; margin-bottom: 20px;
        }
        .filter-form .form-group { min-width: 160px; flex: 1; gap: 4px; }
        .filter-form label { font-size: 12px; font-weight: 600; color: #6b7280; }
        .filter-form .filter-actions { display: flex; gap: 8px; align-items: flex-end; padding-bottom: 0; }

        /* ── PAGINATION ── */
        .pagination {
            display: flex; align-items: center; justify-content: center;
            gap: 4px; margin-top: 20px; list-style: none;
        }
        .pagination .page-link {
            padding: 6px 13px; border-radius: 6px; font-size: 14px;
            color: #374151; text-decoration: none; border: 1px solid #e8eaed;
            background: #fff; transition: all .15s;
        }
        .pagination .page-link:hover { background: #e8f0fe; color: #1a73e8; border-color: #1a73e8; }
        .pagination .active .page-link { background: #1a73e8; color: #fff; border-color: #1a73e8; }
        .pagination .disabled .page-link { color: #d1d5db; pointer-events: none; }

        /* ── METRICS ── */
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
            gap: 16px; margin-bottom: 24px;
        }
        .metric-card {
            background: #fff; border-radius: 10px;
            border: 1px solid #e8eaed;
            padding: 20px 22px;
            box-shadow: 0 1px 4px rgba(0,0,0,.04);
            border-left: 4px solid #1a73e8;
        }
        .metric-card h3 { font-size: 12px; color: #9ca3af; font-weight: 600; text-transform: uppercase; letter-spacing: .4px; margin-bottom: 10px; }
        .metric-card p { font-size: 36px; font-weight: 700; line-height: 1; margin-bottom: 5px; }
        .metric-card small { font-size: 12px; color: #9ca3af; }
    </style>
</head>
<body>

<!-- TOPBAR -->
<header class="portal-topbar">
    <a href="{% url 'tickets:dashboard' %}" class="topbar-brand">
        <i class="bi bi-ticket-detailed-fill"></i> Tickets <span>/ Suporte</span>
    </a>

    <nav class="portal-nav">
        <a href="{% url 'tickets:dashboard' %}"
           class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
            <i class="bi bi-speedometer2"></i> Dashboard
        </a>
        <a href="{% url 'tickets:ticket_list' %}"
           class="{% if 'ticket_list' in request.resolver_match.url_name %}active{% endif %}">
            <i class="bi bi-list-ul"></i> Todos os Tickets
        </a>
        <a href="{% url 'tickets:ticket_create' %}"
           class="{% if request.resolver_match.url_name == 'ticket_create' %}active{% endif %}">
            <i class="bi bi-plus-circle"></i> Novo Ticket
        </a>

        {% if user.is_staff %}
        <div class="nav-sep"></div>
        <a href="{% url 'tickets:categoria_list' %}"
           class="{% if 'categoria' in request.resolver_match.url_name or 'urgencia' in request.resolver_match.url_name or 'status' in request.resolver_match.url_name or 'servico' in request.resolver_match.url_name or 'sla' in request.resolver_match.url_name or 'campo' in request.resolver_match.url_name or 'gatilho' in request.resolver_match.url_name or 'macro' in request.resolver_match.url_name or 'justificativa' in request.resolver_match.url_name or 'regra' in request.resolver_match.url_name %}active{% endif %}">
            <i class="bi bi-sliders"></i> Configurações
        </a>
        {% endif %}
    </nav>

    <div class="topbar-user">
        <span class="username">
            <i class="bi bi-person-circle" style="font-size:16px; color:#9ca3af;"></i>
            {{ user.get_full_name|default:user.username }}
        </span>
        <form method="post" action="{% url 'authentication:logout' %}">
            {% csrf_token %}
            <button type="submit"><i class="bi bi-box-arrow-right"></i> Sair</button>
        </form>
    </div>
</header>

<!-- CONTENT -->
<main class="portal-main">
    {% if messages %}
        {% for message in messages %}
        <div style="padding:12px 16px; margin-bottom:16px; border-radius:8px; font-size:14px;
            {% if message.tags == 'success' %}background:#dcfce7;color:#16a34a;border:1px solid #bbf7d0;
            {% elif message.tags == 'error' %}background:#fee2e2;color:#dc2626;border:1px solid #fecaca;
            {% else %}background:#dbeafe;color:#1d4ed8;border:1px solid #bfdbfe;{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}

    {% block conteudo %}{% endblock %}
</main>

<script src="{% static 'assets/js/script.js' %}"></script>
</body>
</html>